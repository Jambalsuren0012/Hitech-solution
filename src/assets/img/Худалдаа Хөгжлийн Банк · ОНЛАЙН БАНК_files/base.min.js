var miniClndr=null,currentMonth=moment().format("YYYY-MM"),nextMonth=moment().add("month",1).format("YYYY-MM"),events=[],quickTransactionData=null,branchList=[],atmList=[],frate=1,torate=1;function calcAmountQuick(){var a=$("#qt-amount1").val();rateCalculateQuick(a=a.replace(/,/g,""),$("#qt-curcode1").data("curcode"),$("#qt-curcode2").data("curcode"),"#qt-amount2","#qt-rate")}function rateCalculateQuick(a,t,e,r,n){return(a=a.replace(/\,/g,""))<=0?($(r).val(a),$(n).hide(),!0):t==e?($(r).val(numeral(a).format("0,0.00")),$(n).hide(),!0):void apiCall(api_callservice_url,{call:"convert_amount",data:JSON.stringify({locale:_locale,amount:a,curcode1:t,curcode2:e})},(function(a){if(1==a.success){var l=numeral(a.result.retdata).format("0,0.00");$(r).val(l),$(n).length>0&&($(n).show(),$(n).text(numeral(a.result.retparams[1]).format("0,0.00")+" "+t+" = "+numeral(a.result.retparams[0]).format("0,0.00")+" "+e))}}),(function(a){}))}function callTemplate(a){apiCall(api_callservice_url,{call:"template_detail",data:JSON.stringify({locale:_locale,template_id:a})},(function(a){if(1===a.success){var t=a.result.retdata[0];quickTransactionData=t,$("#qt-amount1").val(numeral(t.famount).format("0,0.00")),$("#qt-amount2").val(numeral(t.toamount).format("0,0.00")),$("#qt-account1").text(t.faccntno),$("#qt-account2").text(("91047"!=t.txncode?t.toaccntname+" / ":"")+t.toaccntno),$("#qt-description").val(t.description);var e='<img src="/bundles/web/assets/img/icon/rate-'+t.fcurcode.toLowerCase()+'.png" width="19" style="margin-top: -1px"> <span class="text-dark-blue text-medium">'+t.fcurcode+"</span>";$("#qt-curcode1").html(e),$("#qt-curcode1").data("curcode",t.fcurcode),e='<img src="/bundles/web/assets/img/icon/rate-'+t.tocurcode.toLowerCase()+'.png" width="19" style="margin-top: -1px"> <span class="text-dark-blue text-medium">'+t.tocurcode+"</span>",$("#qt-curcode2").html(e),$("#qt-curcode2").data("curcode",t.tocurcode),t.fcurcode!=t.tocurcode&&rateCalculate(t.famount,t.fcurcode,t.tocurcode,"#qt-amount2","#txn-rate22",t.forto)}}),(function(a){}))}function clearQuickTxn(){$("#qt-amount1").val("0.00"),$("#qt-amount2").val("0.00"),$("#qt-account1").text("-"),$("#qt-account2").text("-"),$("#qt-description").val(""),$(".quick-transaction-template").removeClass("uk-active")}function makeQuickTransaction(a){var t=$("#qt-amount1").val(),e=$("#qt-curcode1").data("curcode"),r=$("#qt-curcode2").data("curcode"),n=$("#qt-amount2").val(),l=$("#qt-description").val();t=t.replace(/,/g,""),n=n.replace(/,/g,"");var c={locale:_locale,customer_id:quickTransactionData.custid,sender_accountno:quickTransactionData.faccntno,receiver_accountno:quickTransactionData.toaccntno,sender_amount:t,receiver_amount:n,sender_curcode:e,receiver_curcode:r,description:l,txn_password:a,txn_code:quickTransactionData.txncode,sender_rate:"1",receiver_rate:"1",receiver_account_name:quickTransactionData.toaccntname,sender_bank_name:"",receiver_bank_name:quickTransactionData.tobankname?quickTransactionData.tobankname:"",sender_bank_number:"",receiver_address:"",receiver_bank_number:quickTransactionData.tobank?quickTransactionData.tobank:"",receiver_swift_code:"",receiver_bank_address:"",transfer_bank_info:"",sender_address:"",receiver_country_code:"",transfer_bank_charge:"",for_to:quickTransactionData.forto,sender_account_name:"",txn_purpose_code:"",txn_purpose_code_sub:"",sender_registerno:"",sender_phone:"",vocode:"",inncode:"",kppcode:"",transfer_bank_name:"",transfer_bank_swift:"",transfer_bank_address:"",transfer_bank_acountno:"",transfer_bank_code:"",transfer_bank_bic:"",receiver_bank_bic:""};apiCall(api_callservice_url,{call:"transaction",data:JSON.stringify(c)},(function(t){_passArray=a,_txnData=c,t.success,UIkit.modal.alert(t.message),clearQuickTxn()}),(function(a){}))}function rateListModal(){apiCall(api_callservice_url,{call:"rate_list",data:JSON.stringify({locale:_locale})},(function(a){if($(".tbl-rate-noncash > tbody").html(""),$(".tbl-rate-cash > tbody").html(""),1==a.success){for(var t=0,e="",r="";a.result.retdata.length>t;){var n=a.result.retdata[t];"MNT"!=n.curcode&&(r+='<tr><td><div class="uk-text-nowrap"><img src="/bundles/web/assets/img/icon/rate-'+n.curcode.toLowerCase()+'.png" width="27" class="margin-right-10" style="vertical-align:text-bottom"><span class="uk-text-bold uk-text-uppercase text-dark text-16 line-1 uk-margin-small-right" style="vertical-align:middle">'+n.curcode+'</span></div><div class="text-12">'+("mn"==_locale?n.namemon:n.nameeng)+'</div></td><td class="text-medium text-dark-blue text-14">'+numeral(n.avgrate).format("0,0.00")+'</td><td class="text-medium text-dark-blue text-14">'+numeral(n.tbuy2).format("0,0.00")+'</td><td class="text-medium text-dark-blue text-14">'+numeral(n.tsell2).format("0,0.00")+"</td></tr>",e+='<tr><td><div class="uk-text-nowrap"><img src="/bundles/web/assets/img/icon/rate-'+n.curcode.toLowerCase()+'.png" width="27" class="margin-right-10" style="vertical-align:text-bottom"><span class="uk-text-bold uk-text-uppercase text-dark text-16 line-1 uk-margin-small-right" style="vertical-align:middle">'+n.curcode+'</span></div><div class="text-12">'+("mn"==_locale?n.namemon:n.nameeng)+'</div></td><td class="text-medium text-dark-blue text-14">'+numeral(n.avgrate).format("0,0.00")+'</td><td class="text-medium text-dark-blue text-14">'+numeral(n.cbuy3).format("0,0.00")+'</td><td class="text-medium text-dark-blue text-14">'+numeral(n.csell3).format("0,0.00")+"</td></tr>"),t++}$(".tbl-rate-noncash > tbody").html(r),$(".tbl-rate-cash > tbody").html(e)}else UIkit.modal.alert(a.message)}),(function(a){}))}function modalRate(){rateListModal(),UIkit.modal("#modal-rate").show().on({"hide.uk.modal":function(){console.log("hide.uk.modal")},"show.uk.modal":function(){}})}function locationList(){loadSaturdayBranches(_locale,"#weekend-tab0")}function modalLocation(){locationList(),UIkit.modal("#modal-location").show().on({"hide.uk.modal":function(){console.log("hide.uk.modal")},"show.uk.modal":function(){}})}function loadTemplateList(a){apiCall(api_callservice_url,{call:"template_list",data:JSON.stringify({locale:_locale,txn_code:a,page:1,page_record:30})},(function(t){if(1==t.success){for(var e='<table class="online-table uk-width-1-1 middle tbl-template-list"><thead><tr><th>'+w1+"</th><th>"+w1+"</th><th></th></tr></thead><tbody>",r=0;t.result.retdata.length>r;){var n=t.result.retdata[r];e+='<tr><td><span class="text-11">'+w1+'</span><br><span class="text-dark text-14">'+n.templatename.replace(/(<([^>]+)>)/gi,"")+'</span></td><td><span class="text-11">'+w2+'</span><br><span class="text-dark text-14">'+n.txncodename+'</span></td><td class="uk-position-relative"><span class="spliter"></span><a type="button" class="round-blue-button uk-margin-small-top lower btn-choose-template" data-id="'+n.templateid+'">'+w3+"</a></td></tr>",r++}e+="</tbody></table>",$("#templatelist"+a).html(e),$(".btn-choose-template").click((function(a){callTemplate($(this).data("id")),UIkit.modal("#modal-template-list").hide()}))}else{e='<div class="disclaimer margin-top-30">'+t.message+"</div>";$("#templatelist"+a).html(e)}}),(function(a){}))}function rateCalculate(a,t,e,r,n,l){return a=a.replace(/\,/g,""),t&&(t=t.trim()),e&&(e=e.trim()),a<=0||t==e?($(r).val(a),$(n).hide(),!0):void apiCall(api_callservice_url,{call:"convert_amount",data:JSON.stringify({locale:_locale,amount:a,curcode1:t,curcode2:e,forto:l})},(function(c){if(1==c.success){frate=c.result.retparams[0],torate=c.result.retparams[1];var i=numeral(c.result.retdata).format("0,0.00");"T"==l&&(i=parseFloat(a*c.result.retparams[1]/c.result.retparams[0]).toFixed(2),i=numeral(i).format("0,0.00")),$(r).val(i),$(n).length>0&&($(n).show(),$(n).text(numeral(c.result.retparams[1]).format("0,0.00")+" "+t+" = "+numeral(c.result.retparams[0]).format("0,0.00")+" "+e)),"#calculated_amount"!=r&&($("#ToAmountRate").length>0&&$("#ToAmountRate").val(numeral(c.result.retparams[1]).format("0,0.00")),$("#FromAmountRate").length>0&&$("#FromAmountRate").val(numeral(c.result.retparams[0]).format("0,0.00")))}else UIkit.modal.alert(c.message)}),(function(a){}))}$((function(){$("#modal-template-tab").on("change.uk.tab",(function(a,t,e){$(t).data("tab");loadTemplateList($(t).data("code"))})),UIkit.modal("#modal-template-list").on({"hide.uk.modal":function(){},"show.uk.modal":function(){loadTemplateList("91047")}}),$("#qt-account1").click((function(a){"-"==$(this).text()&&UIkit.modal.alert("Загварын жагсаалтаас гүйлгээ хийх загвараа сонгоно уу")})),$("#qt-account2").click((function(a){"-"==$(this).text()&&UIkit.modal.alert("Загварын жагсаалтаас гүйлгээ хийх загвараа сонгоно уу")})),$(".input-numeral").length&&new Cleave(".input-numeral",{numeralThousandsGroupStyle:"thousand",numeral:!0,numeralPositiveOnly:!0,numeralDecimalMark:".",delimiter:",",numeralDecimalScale:2}),$(".quick-transaction-template").click((function(a){$(".quick-transaction-template").removeClass("uk-active"),callTemplate($(this).data("templateid")),$(this).addClass("uk-active")})),$("#qt-amount1").change((function(a){calcAmountQuick()})),$(".qt-dropdown-curcode1 li").click((function(a){var t=$(this).find("a").html(),e=$(this).data("curcode");$(".qt-dropdown-curcode1 .selected-text").html(t),$(".qt-dropdown-curcode1 .selected-text").data("curcode",e),calcAmountQuick()})),$(".qt-dropdown-curcode2 li").click((function(a){var t=$(this).find("a").html(),e=$(this).data("curcode");$(".qt-dropdown-curcode2 .selected-text").html(t),$(".qt-dropdown-curcode2 .selected-text").data("curcode",e),calcAmountQuick()})),$("#quick-transaction-form").validate({rules:{},messages:{},errorElement:"em",errorPlacement:function(a,t){a.addClass("invalid-feedback"),"checkbox"===t.prop("type")?a.insertAfter(t.parent("label")):a.insertAfter(t)},highlight:function(a,t,e){$(a).addClass("is-invalid").removeClass("is-valid")},unhighlight:function(a,t,e){$(a).addClass("is-valid").removeClass("is-invalid")},submitHandler:function(a){return null==quickTransactionData?(UIkit.modal.alert("Гүйлгээний загвар сонгогдоогүй байна!"),!1):(apiCall(api_callservice_url,{call:"pertran",data:JSON.stringify({opercode:quickTransactionData.txncode})},(function(a){if(1!=a.success)return UIkit.modal.alert(a.message),!1;var t=[{gentype:"",passname:"",passname2:"",passorderno:"",passpolicyid:"",passtype:"",phonecreate:"",spsecruleid:"",txnlimit:"",value:""}],e="Та гүйлгээний нууц үгээ оруулна уу";a.result.retparams&&a.result.retparams.length>0?(t=a.result.retparams,e="mn"==_locale?a.result.retparams[0].passname+" оруулна уу":"Please type "+a.result.retparams[0].passname2,password9Confirm(e,(function(a){t[0].value=a,makeQuickTransaction(t)}),(function(){}))):makeQuickTransaction(t)}),(function(a){})),!1)}}),$("#tab-weekend li").click((function(a){0==$(this).data("tab")?loadSaturdayBranches(_locale,"#weekend-tab0"):loadSundayBranches(_locale,"#weekend-tab1")})),$(".location-tab-ul >li").click((function(a){var t=$(this).data("tab");0==t?loadSaturdayBranches(_locale,"#weekend-tab0"):1==t?loadUbDists(_locale,""):2==t||4==t?loadAimags(_locale,""):3==t&&($("#map").show(),$(".marker-explain").css("display","flex"),loadGoogleMap(0),$(".marker-explain-branches").parent().css("display","flex"),$(".marker-explain-filter").parent().css("display","flex"),$(".marker-explain-atms").parent().hide(),$(".marker-explain-ladies").parent().hide(),$(".marker-explain-brittos").parent().hide())})),$("#tab-map >li").click((function(a){var t=$(this).data("tab");0==t?($(".marker-explain-branches").parent().css("display","flex"),$(".marker-explain-filter").parent().css("display","flex"),$(".marker-explain-atms").parent().hide(),$(".marker-explain-ladies").parent().hide(),$(".marker-explain-brittos").parent().hide()):1==t?($(".marker-explain-branches").parent().hide(),$(".marker-explain-filter").parent().css("display","flex"),$(".marker-explain-atms").parent().css("display","flex"),$(".marker-explain-ladies").parent().hide(),$(".marker-explain-brittos").parent().hide()):2==t?($(".marker-explain-branches").parent().hide(),$(".marker-explain-filter").parent().css("display","flex"),$(".marker-explain-atms").parent().hide(),$(".marker-explain-ladies").parent().css("display","flex"),$(".marker-explain-brittos").parent().hide()):3==t?($(".marker-explain-branches").parent().css("display","flex"),$(".marker-explain-filter").parent().hide(),$(".marker-explain-atms").parent().css("display","flex"),$(".marker-explain-ladies").parent().css("display","flex"),$(".marker-explain-brittos").parent().css("display","flex")):4==t&&($(".marker-explain-branches").parent().hide(),$(".marker-explain-filter").parent().css("display","flex"),$(".marker-explain-atms").parent().hide(),$(".marker-explain-ladies").parent().hide(),$(".marker-explain-brittos").parent().css("display","flex"))}))})),$(document).on("change","#calculate_amount",(function(){var a=$(this).val();rateCalculate(a=a.replace(/,/g,""),$(".calculate_curcode1").find("img").data("curcode"),$(".calculate_curcode2").find("img").data("curcode"),"#calculated_amount","#rate111","F")})),$(document).on("click",".dropdown-curcode",(function(){var a=$("#calculate_amount").val();rateCalculate(a=a.replace(/,/g,""),$(".calculate_curcode1").find("img").data("curcode"),$(".calculate_curcode2").find("img").data("curcode"),"#calculated_amount","#rate111","F")})),$(document).on("click",".marker-explain-ladies",(function(){loadGoogleMap(3)})),$(document).on("click",".marker-explain-branches",(function(){loadGoogleMap(0)})),$(document).on("click",".marker-explain-atms",(function(){loadGoogleMap(1)})),$(document).on("click",".marker-explain-depoatms",(function(){loadGoogleMap(5)})),$(document).on("click",".marker-explain-brittos",(function(){loadGoogleMap(4)})),$(document).on("click",".logout",(function(){apiCall(api_callservice_url,{call:"logout",data:JSON.stringify({locale:_locale})},(function(a){$("#uk-login-url").submit()}),(function(a){}))})),$(document).on("click",".notification",(function(){apiCall(api_callservice_url,{call:"message_inbox_new",data:JSON.stringify({locale:_locale,page:1,page_record:5,fasten:1})},(function(a){if(1==a.success){var t="",e=0;for(a.result.retdata.length>0&&$(".notification ul").empty();a.result.retdata.length>e;){var r=a.result.retdata[e];t+='<li><a href="'+$(".notification .dropdown-footer a").attr("href")+'"><div class="uk-grid uk-grid-collapse margin-top-10 margin-bottom-10"><div class="uk-width" style="width: 50px"><img class="uk-border-circle" src="/bundles/web/assets/img/tmp/notification-1.jpg" width="50"></div><div class="uk-width" style="width:calc(100% - 50px)"><div class="uk-margin-left">'+r.subject+'<div class="text-gray-blue uk-margin-small-top">'+r.datetime+"</div></div></div></div></a> </li>",$(".notification ul").append(t),e++}}}),(function(a){}))})),$("#map-nav-city-choice").on("change",(function(){var a="0"!=$(this).val()?$(this).val():void 0,t=$(".map-navigation.selected").data("branchtype");loadGoogleMap(t,a),getDistAndSoumList(a)})),$("#map-nav-dist-choice").on("change",(function(){var a="0"!=$("#map-nav-city-choice").val()?$("#map-nav-city-choice").val():void 0,t=$(".map-navigation.selected").data("branchtype"),e="0"!=$(this).val()?$(this).val():void 0;loadGoogleMap(t,a,e)}));